<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Automation Hub ‚ö°</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <span class="logo-icon">‚ö°</span>
          <h1>Automation Hub</h1>
        </div>
        <input type="text" id="search-automations" placeholder="Search automations..." class="search-input" oninput="filterAutomations()">
      </div>
    </header>

    <!-- Stats Bar -->
    <div class="stats-bar">
      <div class="stat">
        <span class="stat-value" id="stat-total">0</span>
        <span class="stat-label">Total</span>
      </div>
      <div class="stat">
        <span class="stat-value stat-enabled" id="stat-enabled">0</span>
        <span class="stat-label">Active</span>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab('automations')">Automations</button>
      <button class="tab tab-builder" onclick="switchTab('builder')">+ Create Automation</button>
    </div>

    <!-- Automations Tab -->
    <div class="tab-content active" id="tab-automations">
      <!-- Loading Indicator -->
      <div class="loading-indicator" id="loading-indicator">
        <div class="loading-spinner"></div>
        <p>Loading your automations...</p>
      </div>

      <!-- Main Content -->
      <main class="main">
        <div class="automations-grid" id="automations-grid">
          <!-- Loaded via JS -->
        </div>
        <div class="empty-state" id="empty-state">
          <div class="empty-icon">üöÄ</div>
          <h3>Get started with automations</h3>
          <p>Automations help you run tasks automatically on your schedule. Create your first one to save time!</p>
          <button class="btn btn-primary btn-large" onclick="switchTab('builder')">Create Your First Automation</button>
        </div>
      </main>
    </div>

    <!-- Visual Builder Tab - Step by Step -->
    <div class="tab-content" id="tab-builder">
      <div class="step-builder">
        
        <!-- Progress Bar -->
        <div class="progress-bar">
          <div class="progress-step active" data-step="1">
            <div class="step-number">1</div>
            <div class="step-label">Trigger</div>
          </div>
          <div class="progress-line"></div>
          <div class="progress-step" data-step="2">
            <div class="step-number">2</div>
            <div class="step-label">Action</div>
          </div>
          <div class="progress-line"></div>
          <div class="progress-step" data-step="3">
            <div class="step-number">3</div>
            <div class="step-label">Review</div>
          </div>
        </div>

        <!-- Step 1: Choose Trigger -->
        <div class="builder-step active" id="step-1">
          <h2 class="step-title">What should start your automation?</h2>
          <p class="step-desc">Select an event or time that will trigger this automation</p>
          
          <div class="cards-grid">
            <button class="choice-card" data-trigger="schedule" onclick="selectTrigger('schedule')">
              <div class="card-icon">‚è∞</div>
              <div class="card-title">Schedule</div>
              <div class="card-desc">Run at a specific time</div>
            </button>
            
            <button class="choice-card" data-trigger="webhook" onclick="selectTrigger('webhook')">
              <div class="card-icon">üîó</div>
              <div class="card-title">Webhook</div>
              <div class="card-desc">HTTP endpoint trigger</div>
            </button>
            
            <button class="choice-card" data-trigger="file_change" onclick="selectTrigger('file_change')">
              <div class="card-icon">üìÅ</div>
              <div class="card-title">File Watch</div>
              <div class="card-desc">When files change</div>
            </button>
            
            <button class="choice-card" data-trigger="email" onclick="selectTrigger('email')">
              <div class="card-icon">üìß</div>
              <div class="card-title">Email</div>
              <div class="card-desc">When emails arrive</div>
            </button>
            
            <button class="choice-card" data-trigger="calendar" onclick="selectTrigger('calendar')">
              <div class="card-icon">üìÖ</div>
              <div class="card-title">Calendar</div>
              <div class="card-desc">Calendar events</div>
            </button>
            
            <button class="choice-card" data-trigger="system" onclick="selectTrigger('system')">
              <div class="card-icon">üñ•Ô∏è</div>
              <div class="card-title">System</div>
              <div class="card-desc">Resource monitoring</div>
            </button>
          </div>
          
          <!-- Trigger Settings (shown after selection) -->
          <div class="step-settings" id="trigger-settings" style="display:none">
            <h3>Configure Trigger</h3>
            <div class="trigger-config" data-trigger="schedule">
              <div class="form-group">
                <label>Schedule</label>
                <select id="schedule-preset" onchange="updateSchedulePreset()">
                  <option value="every-hour">Every hour</option>
                  <option value="every-day-9am" selected>Every day at 9:00 AM</option>
                  <option value="every-day-6pm">Every day at 6:00 PM</option>
                  <option value="every-monday">Every Monday at 8:00 AM</option>
                  <option value="every-weekday">Every weekday at 9:00 AM</option>
                  <option value="every-month">First day of every month</option>
                  <option value="every-minute">Every minute (testing)</option>
                </select>
              </div>
              <div class="form-group" id="cron-group">
                <label>Cron Expression</label>
                <input type="text" id="cron" placeholder="0 9 * * *" value="0 9 * * *">
              </div>
              <p class="help-text" id="cron-preview">Runs: Every day at 9:00 AM</p>
            </div>
            
            <div class="trigger-config" data-trigger="webhook" style="display:none">
              <div class="form-row">
                <div class="form-group">
                  <label>Port</label>
                  <input type="number" id="webhook-port" value="18800">
                </div>
                <div class="form-group flex-1">
                  <label>Endpoint</label>
                  <input type="text" id="webhook-endpoint" value="/automation">
                </div>
              </div>
              <p class="help-text">POST to <code id="webhook-url">http://localhost:18800/automation</code></p>
            </div>
            
            <div class="trigger-config" data-trigger="file_change" style="display:none">
              <div class="form-group">
                <label>Path to Watch</label>
                <input type="text" id="watch-path" value="~/">
              </div>
              <div class="form-group">
                <label>Events to Watch</label>
                <div class="checkbox-row">
                  <label><input type="checkbox" id="event-modify" checked> Modify</label>
                  <label><input type="checkbox" id="event-add" checked> Add</label>
                  <label><input type="checkbox" id="event-delete"> Delete</label>
                </div>
              </div>
            </div>
            
            <div class="trigger-config" data-trigger="email" style="display:none">
              <div class="form-row">
                <div class="form-group">
                  <label>IMAP Host</label>
                  <input type="text" id="email-host" value="imap.gmail.com">
                </div>
                <div class="form-group flex-1">
                  <label>Email Address</label>
                  <input type="email" id="email-user" placeholder="your@email.com">
                </div>
              </div>
              <div class="form-group">
                <label>Check Every</label>
                <select id="email-interval">
                  <option value="30">30 seconds</option>
                  <option value="60" selected>1 minute</option>
                  <option value="300">5 minutes</option>
                </select>
              </div>
            </div>
            
            <div class="trigger-config" data-trigger="calendar" style="display:none">
              <div class="form-group">
                <label>Calendar Provider</label>
                <select id="calendar-provider">
                  <option value="google">Google Calendar</option>
                  <option value="apple">Apple Calendar</option>
                </select>
              </div>
              <div class="form-group">
                <label>Check Every</label>
                <select id="calendar-interval">
                  <option value="1">1 minute</option>
                  <option value="5" selected>5 minutes</option>
                  <option value="15">15 minutes</option>
                </select>
              </div>
            </div>
            
            <div class="trigger-config" data-trigger="system" style="display:none">
              <div class="form-row">
                <div class="form-group">
                  <label>CPU Alert (%)</label>
                  <input type="number" id="sys-cpu" value="90" min="1" max="100">
                </div>
                <div class="form-group">
                  <label>Memory Alert (%)</label>
                  <input type="number" id="sys-mem" value="90" min="1" max="100">
                </div>
                <div class="form-group">
                  <label>Disk Alert (%)</label>
                  <input type="number" id="sys-disk" value="95" min="1" max="100">
                </div>
              </div>
            </div>
          </div>
          
          <div class="step-actions">
            <button class="btn btn-primary btn-large" onclick="goToStep(2)" id="btn-next-1" disabled>
              Continue to Action ‚Üí
            </button>
          </div>
        </div>

        <!-- Step 2: Choose Action -->
        <div class="builder-step" id="step-2">
          <h2 class="step-title">What should happen next?</h2>
          <p class="step-desc">Select the action to perform when the trigger fires</p>
          
          <div class="cards-grid">
            <button class="choice-card" data-action="shell" onclick="selectAction('shell')">
              <div class="card-icon">üíª</div>
              <div class="card-title">Run Command</div>
              <div class="card-desc">Execute a terminal command</div>
            </button>
            
            <button class="choice-card" data-action="agent" onclick="selectAction('agent')">
              <div class="card-icon">ü§ñ</div>
              <div class="card-title">AI Agent</div>
              <div class="card-desc">Run an AI task</div>
            </button>
            
            <button class="choice-card" data-action="git" onclick="selectAction('git')">
              <div class="card-icon">üîÄ</div>
              <div class="card-title">Git</div>
              <div class="card-desc">Auto-commit & push</div>
            </button>
            
            <button class="choice-card" data-action="notify" onclick="selectAction('notify')">
              <div class="card-icon">üì±</div>
              <div class="card-title">Notify</div>
              <div class="card-desc">Send a notification</div>
            </button>
            
            <button class="choice-card" data-action="email_reply" onclick="selectAction('email_reply')">
              <div class="card-icon">üìß</div>
              <div class="card-title">Email Reply</div>
              <div class="card-desc">Send an email</div>
            </button>
          </div>
          
          <!-- Action Settings (shown after selection) -->
          <div class="step-settings" id="action-settings" style="display:none">
            <h3>Configure Action</h3>
            
            <div class="action-config" data-action="shell" style="display:none">
              <div class="form-group">
                <label>Command to Run</label>
                <input type="text" id="shell-command" placeholder="e.g., npm run build, python backup.py">
              </div>
            </div>
            
            <div class="action-config" data-action="agent" style="display:none">
              <div class="form-group">
                <label>Task Description</label>
                <textarea id="agent-prompt" rows="3" placeholder="What should the AI do?"></textarea>
              </div>
              <div class="form-group">
                <label>AI Model</label>
                <select id="agent-model">
                  <option value="claude-opus-4-5">Claude Opus 4</option>
                  <option value="claude-sonnet-4">Claude Sonnet 4</option>
                  <option value="gpt-4">GPT-4</option>
                </select>
              </div>
            </div>
            
            <div class="action-config" data-action="git" style="display:none">
              <div class="form-group">
                <label>Repository Path</label>
                <input type="text" id="git-path" placeholder="~/Projects/my-repo">
              </div>
              <div class="checkbox-row">
                <label><input type="checkbox" id="git-add" checked> git add .</label>
                <label><input type="checkbox" id="git-commit" checked> Auto-commit</label>
                <label><input type="checkbox" id="git-push" checked> Auto-push</label>
              </div>
            </div>
            
            <div class="action-config" data-action="notify" style="display:none">
              <div class="form-group">
                <label>Channel</label>
                <select id="notify-channel">
                  <option value="telegram">Telegram</option>
                  <option value="slack">Slack</option>
                  <option value="discord">Discord</option>
                </select>
              </div>
              <div class="form-group">
                <label>Message</label>
                <textarea id="notify-message" rows="2" placeholder="Your notification message"></textarea>
              </div>
            </div>
            
            <div class="action-config" data-action="email_reply" style="display:none">
              <div class="form-group">
                <label>Subject</label>
                <input type="text" id="email-subject" placeholder="Re: Your email">
              </div>
              <div class="form-group">
                <label>Message</label>
                <textarea id="email-body" rows="4" placeholder="Your auto-reply message"></textarea>
              </div>
            </div>
          </div>
          
          <div class="step-actions">
            <button class="btn btn-secondary btn-large" onclick="goToStep(1)">
              ‚Üê Back
            </button>
            <button class="btn btn-primary btn-large" onclick="goToStep(3)" id="btn-next-2" disabled>
              Review & Save ‚Üí
            </button>
          </div>
        </div>

        <!-- Step 3: Review & Save -->
        <div class="builder-step" id="step-3">
          <h2 class="step-title">Review your automation</h2>
          <p class="step-desc">Give your automation a name and save it</p>
          
          <!-- Summary Card -->
          <div class="summary-card">
            <div class="summary-row">
              <span class="summary-label">Trigger</span>
              <span class="summary-value" id="summary-trigger">-</span>
            </div>
            <div class="summary-row">
              <span class="summary-label">Action</span>
              <span class="summary-value" id="summary-action">-</span>
            </div>
            <div class="summary-row summary-name">
              <span class="summary-label">Name</span>
              <input type="text" id="automation-name" class="summary-input" placeholder="e.g., Daily backup at 9AM">
            </div>
          </div>
          
          <div class="step-actions">
            <button class="btn btn-secondary btn-large" onclick="goToStep(2)">
              ‚Üê Back
            </button>
            <button class="btn btn-primary btn-large btn-save" onclick="saveAutomationFromBuilder()">
              ‚úì Save Automation
            </button>
          </div>
        </div>
        
      </div>
    </div>

    <!-- Activity Feed -->
    <section class="logs-section">
      <div class="section-header">
        <h2>Activity Feed</h2>
      </div>
      <div class="logs-list" id="activity-feed">
        <div class="log-item log-info">Dashboard connected - Waiting for updates...</div>
      </div>
    </section>
  </div>

  <!-- Toast -->
  <div class="toast-container" id="toast-container"></div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" id="delete-modal-overlay" onclick="closeDeleteModal()"></div>
  <div class="modal modal-delete" id="delete-modal">
    <div class="modal-header">
      <h2>Delete Automation</h2>
      <button class="modal-close" onclick="closeDeleteModal()">√ó</button>
    </div>
    <div class="modal-body">
      <p class="delete-message" id="delete-message">Are you sure you want to delete this automation? This action cannot be undone.</p>
      <div class="delete-actions">
        <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
        <button class="btn btn-danger" id="confirm-delete-btn">Delete</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
